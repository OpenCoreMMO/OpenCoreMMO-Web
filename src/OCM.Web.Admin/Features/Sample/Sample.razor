@page "/Sample"
@using MediatR
@using OCM.Application.Requests.Commands
@inject IMediator Mediator
@inject ProgressBarState ProgressBarState
@inject ISnackbar Snackbar

<PageTitle>Sample Data</PageTitle>

@rendermode @(new InteractiveServerRenderMode(false))

<MudContainer MaxWidth="MaxWidth.Large">
    <MudText Typo="Typo.h4" GutterBottom="true">Sample Data Generation</MudText>
    <MudText Typo="Typo.body1" Color="Color.Secondary" GutterBottom="true">
        Generate sample accounts and players for testing purposes.
    </MudText>

    <!-- Account Section -->
    <MudCard Class="mb-4">
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h6">Create Sample Account</MudText>
            </CardHeaderContent>
        </MudCardHeader>
        <MudCardContent>
            <MudForm @ref="accountForm" @bind-IsValid="@accountSuccess" ValidationDelay="0">
                <MudGrid>
                    <MudItem xs="12" sm="6">
                        <MudTextField @bind-Value="newAccount.AccountName" Label="Username" Required="true" RequiredError="Username is required!" />
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudTextField @bind-Value="newAccount.Email" Label="Email" Required="true" RequiredError="Email is required!" />
                    </MudItem>
                    <MudItem xs="12" sm="4">
                        <MudTextField @bind-Value="newAccount.Password" Label="Password" InputType="InputType.Password" Required="true" RequiredError="Password is required!" />
                    </MudItem>
                    <MudItem xs="12" sm="4">
                        <MudNumericField @bind-Value="newAccount.Coins" Label="Coins" Min="0" />
                    </MudItem>
                    <MudItem xs="12" sm="4">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="CreateAccount" Disabled="!accountSuccess">
                            Create Account
                        </MudButton>
                    </MudItem>
                </MudGrid>
            </MudForm>
        </MudCardContent>
    </MudCard>

    <!-- Player Section -->
    <MudCard Class="mb-4">
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h6">Create Sample Player</MudText>
            </CardHeaderContent>
        </MudCardHeader>
        <MudCardContent>
            <MudForm @ref="playerForm" @bind-IsValid="@playerSuccess" ValidationDelay="0">
                <MudGrid>
                    <MudItem xs="12" sm="6">
                        <MudTextField @bind-Value="newPlayer.Name" Label="Player Name" Required="true" RequiredError="Player name is required!" />
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudSelect @bind-Value="newPlayer.Vocation" Label="Vocation" Required="true" RequiredError="Vocation is required!">
                            <MudSelectItem Value="1">Knight</MudSelectItem>
                            <MudSelectItem Value="2">Paladin</MudSelectItem>
                            <MudSelectItem Value="3">Druid</MudSelectItem>
                            <MudSelectItem Value="4">Sorcerer</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudNumericField @bind-Value="newPlayer.Level" Label="Level" Min="1" Max="1000" Required="true" RequiredError="Level is required!" />
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudSelect @bind-Value="newPlayer.Sex" Label="Gender" Required="true" RequiredError="Gender is required!">
                            <MudSelectItem Value="0">Female</MudSelectItem>
                            <MudSelectItem Value="1">Male</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudNumericField @bind-Value="newPlayer.AccountId" Label="Account ID" Required="true" RequiredError="Account ID is required!" />
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="CreatePlayer" Disabled="!playerSuccess">
                            Create Player
                        </MudButton>
                    </MudItem>
                </MudGrid>
            </MudForm>
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private MudForm accountForm;
    private bool accountSuccess;
    private MudForm playerForm;
    private bool playerSuccess;

    private CreateAccountRequest newAccount = new();
    private CreatePlayerRequest newPlayer = new();

    private async Task CreateAccount()
    {
        var result = await Mediator.Send(newAccount);

        if (result.IsSuccess)
        {
            Snackbar.Add("Account created successfully!", Severity.Success);
            newAccount = new CreateAccountRequest();
        }
        else
        {
            Snackbar.Add($"Failed to create account: {result.ErrorMessage}", Severity.Error);
        }
    }

    private async Task CreatePlayer()
    {
        // Set default values for required fields
        newPlayer.Town = 1; // Default town
        newPlayer.WorldId = 1; // Default world
        newPlayer.PosX = 100;
        newPlayer.PosY = 100;
        newPlayer.PosZ = 7;

        var result = await Mediator.Send(newPlayer);

        if (result.IsSuccess)
        {
            Snackbar.Add("Player created successfully!", Severity.Success);
            newPlayer = new CreatePlayerRequest();
        }
        else
        {
            Snackbar.Add($"Failed to create player: {result.ErrorMessage}", Severity.Error);
        }
    }
}